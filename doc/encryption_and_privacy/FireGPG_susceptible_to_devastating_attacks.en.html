<!DOCTYPE html>

<html lang="en" dir="ltr" xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tails - FireGPG susceptible to devastating attacks</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="icon" href="../../favicon.ico" type="image/x-icon" />

<link rel="stylesheet" href="../../style.css" type="text/css" />

<link rel="stylesheet" href="../../local.css?reload-2021-06-25" type="text/css" />


<script src="../../lib/js/mirror-dispatcher.js" type="text/javascript"></script>









</head>


<body class="en">


<div class="banner" role="banner">
  <a class="tails" href="../../index.html"><span>Tails</span></a>
  <div id="search-and-donate">
    
    
    
    <div class="donate">
      <a href="https://tails.boum.org/donate/?r=topbar" class="en"><span>Donate</span></a>
      <a href="https://tails.boum.org/donate/?r=topbar" class="de"><span>Spenden</span></a>
      <a href="https://tails.boum.org/donate/?r=topbar" class="es"><span>Donar</span></a>
      <a href="https://tails.boum.org/donate/?r=topbar" class="fa"><span>اهدا کردن</span></a>
      <a href="https://tails.boum.org/donate/?r=topbar" class="fr"><span>Faire un don</span></a>
      <a href="https://tails.boum.org/donate/?r=topbar" class="it"><span>Dona</span></a>
      <a href="https://tails.boum.org/donate/?r=topbar" class="pt"><span>Faça uma doação</span></a>
      <a href="https://tails.boum.org/donate/?r=topbar" class="ru"><span>Пожертвовать</span></a>
    </div>
  </div>
</div>



<div class="topbar" role="navigation">
<ul>
  <li><a href="../../index.html">Home</a></li>
  <li><a href="../../about.en.html">How Tails works</a></li>
  <li><a href="../../install.en.html">Get Tails</a></li>
  <li><a href="../../doc.en.html">Documentation</a></li>
  <li><a href="../../support.en.html">Support</a></li>
  <li><a href="../../contribute.en.html">Contribute</a></li>
  <li><a href="../../news.en.html">News</a></li>
  <li><a href="../../jobs.html">Jobs</a></li>
</ul>


</div>



<div class="page">

<div class="pageheader">

<div class="parentlinks">
<ul id="crumbs">
<li><a href="../../index.html"><img alt="home" src="../../lib/home.png"></a></li>







<li><a href="../../doc.en.html">doc</a></li>





<li><a href="../encryption_and_privacy.en.html">encryption and privacy</a></li>




<li>FireGPG susceptible to devastating attacks</li>

</ul>
</div>


<div id="otherlanguages">
<ul>
   
   <li class="current master">
   <span >English
   </span>
   </li>

   


   

   <li >

   <span class="visible"><a href="./FireGPG_susceptible_to_devastating_attacks.de.html">de</a></span>
   <span class="hidden"><a href="./FireGPG_susceptible_to_devastating_attacks.de.html">Deutsch</a></span>

   </li>
   

   <li >

   <span class="visible"><a href="./FireGPG_susceptible_to_devastating_attacks.es.html">es</a></span>
   <span class="hidden"><a href="./FireGPG_susceptible_to_devastating_attacks.es.html">Español</a></span>

   </li>
   

   <li >

   <span class="visible"><a href="./FireGPG_susceptible_to_devastating_attacks.fr.html">fr</a></span>
   <span class="hidden"><a href="./FireGPG_susceptible_to_devastating_attacks.fr.html">Français</a></span>

   </li>
   

   <li >

   <span class="visible"><a href="./FireGPG_susceptible_to_devastating_attacks.it.html">it</a></span>
   <span class="hidden"><a href="./FireGPG_susceptible_to_devastating_attacks.it.html">Italiano</a></span>

   </li>
   

   <li >

   <span class="visible"><a href="./FireGPG_susceptible_to_devastating_attacks.pt.html">pt</a></span>
   <span class="hidden"><a href="./FireGPG_susceptible_to_devastating_attacks.pt.html">Português</a></span>

   </li>
   

   <li >

   <span class="visible"><a href="./FireGPG_susceptible_to_devastating_attacks.ru.html">ru</a></span>
   <span class="hidden"><a href="./FireGPG_susceptible_to_devastating_attacks.ru.html">Русский</a></span>

   </li>
   
</ul>
</div>


<div class="header">
<span class="title">
FireGPG susceptible to devastating attacks
</span>
</div>






</div>

<div id="pagebody">

<div id="content" role="main">
<p><strong>FireGPG is no more shipped in Tails.</strong></p>

<p>You should instead use our custom GPG applet to:</p>

<ul>
<li><a href="./gpgapplet/passphrase_encryption.en.html">Encrypt text with a passphrase</a></li>
<li><a href="./gpgapplet/public-key_cryptography.en.html">Encrypt and sign text using public-key cryptography</a></li>
<li><a href="./gpgapplet/decrypt_verify.en.html">Decrypt and verify text</a></li>
</ul>


<div class="toc">
<ol>
	<li class="L1"><a href="#index1h1">Advisory</a>
	</li>
	<li class="L1"><a href="#index2h1">Sample attack</a>
	</li>
	<li class="L1"><a href="#index3h1">Other ressources</a>
	</li>
	<li class="L1"><a href="#index4h1">Other possible issues</a>
	</li>
</ol>
</div>


<h1><a name="index1h1"></a>Advisory</h1>

<p><a href="http://getfiregpg.org/">FireGPG</a> is a Firefox addon that allows users to easily perform
cryptographic actions on the contents of HTML pages, e.g. to verify
signatures appearing as HTML text, or encrypt texts written inside
HTML text boxes (i.e. &lt;textarea&gt;). Webmail interfaces commonly use
text boxes for email composition, so FireGPG is a natural fit for this
use case: the user writes his or her email plaintext in the text box,
selects the plaintext and uses one of the &quot;Encrypt&quot; or &quot;Sign and
encrypt&quot; actions available from the FireGPG menu to transform the
selection to its encrypted counterpart.</p>

<p>The FireGPG design incorrectly assumes that this is safe, but it is
not, since JavaScript running on the page can still control and
observe much of what is happening on the page. For instance, a simple
script can set up a timer that silently submits the contents of the
text box back to the server every second, thereby leaking the
plaintext as it is written, effectively bypassing any subsequent
encryption. In fact, many non-malicious webmail services do just that
at longer intervals, to save a draft of a message in case the user&#39;s
browser crashes. The only way that a user can block this type of
attack is by completely disabling JavaScript, which is often not
desirable. In any case, FireGPG currently does nothing to make users
aware of this issue. To the contrary, by making encryption commands
easily accessible in the FireGPG context menu, it actively promotes
this insecure usage.</p>

<p>The situation is exactly the same if a user decrypts an OpenPGP block
inside a text box: the OpenPGP block is replaced with the plaintext
within the text box, so the same script can leak the plaintext when
the timer fires less than a second later. Luckily, webmail systems
rarely present messages in text boxes (although &#39;pastebins&#39; often
do). It is more common for received email to be displayed as HTML
text, and when the user decrypts it, FireGPG will display the
plaintext in a separate window that is safely out of reach of
JavaScript. FireGPG has an option,
<code>extensions.firegpg.result_always_in_new_window</code>, called &quot;Always
display encryption and signature results in a separate window&quot; in the
FireGPG options window, that forces this behaviour when
decrypting OpenPGP blocks in text boxes as well, but it is disabled by
default. This option, however, does not in any way prevent leaking of
plaintext while the user is writing it as described in the previous
paragraph.</p>

<p>FireGPG also has three commands to sign (but not encrypt) messages:
&quot;Sign&quot;, &quot;Wrapped sign&quot; and &quot;Clearsign&quot;. Simple JavaScript can replace
the contents of the text box when the user selects it, so if the user
does not re-read the text after selecting one of the &#39;sign&#39; commands,
the attacker will be able to obtain the user&#39;s signature on an
arbitrary message. Enabling the <code>result_always_in_new_window</code> option does not prevent this attack;
only user acuity <em>may</em> be able to detect and block it.</p>

<p>It should be clear that the current FireGPG design of performing
cryptographic actions on the contents of text boxes is fundamentally
flawed and unsecurable. FireGPG&#39;s current design and interface is
training users to act as if the contents of text boxes are private
until they are explicitly submitted by the user (e.g. by pressing a
&quot;Submit&quot;/&quot;Send&quot; button). Hence:</p>

<ol>
<li>It is critical that all actions related to encryption and signing
be removed from the FireGPG menu. The only way to perform these
actions should be through the FireGPG Text editor, which is located
in a separate window and thus safely out of the reach of content
JavaScript. The FireGPG Text editor is already available through
the FireGPG menu and makes all actions easily accessible.</li>
<li>FireGPG should explicitly state that the FireGPG Text editor is the
only safe place to write plaintext that are to be encrypted and/or
signed, or to decrypt messages unless the
<code>result_always_in_new_window</code> option is enabled. Hopefully
this will save users that have been misled by FireGPG for years
from risking their data again, and make them understand why this
new, less convenient, mode of operation is necessary. Otherwise,
they may continue writing their plaintext in JavaScript-accessible
text boxes, and then copy-and-paste it into the FireGPG Text editor
just to encrypt it, instead of writing it there from the start.</li>
<li>The <code>result_always_in_new_window</code> option should be removed -- its behaviour should be forcibly
enabled instead.</li>
<li>The &quot;Verify&quot; command should display the contents of the signed
message in the FireGPG Text editor.  Otherwise, it may be possible
to present to the user a different message from that seen by
FireGPG.</li>
</ol>


<p>After these changes, the only remaining actions in the FireGPG menu
will be &quot;Decrypt&quot; and &quot;Verify&quot;. &quot;Decrypt&quot; is made safe by change 3,
and &quot;Verify&quot; is made safe by change 4.  It may still be a good idea to
remove these actions as well to further promote the use of the FireGPG
Text editor for all cryptographic actions. If they are removed, points
3 and 4 above become irrelevant and may be ignored.
Per a discussion on #tor-dev and later #tails with rransom and katmagic it came
to light that FireGPG may have a few serious security and anonymity issues
(katmagic even claimed with &quot;85%&quot; certainty that these issues were among the
main reasons FireGPG was discontinued):</p>

<h1><a name="index2h1"></a>Sample attack</h1>

<pre><code>&lt;html&gt;
    &lt;head&gt;
        &lt;script type=&quot;text/javascript&quot;&gt;
            function decrypt() {
                var elem = document.getElementById(&quot;pgp_msg&quot;);

                if (elem.innerHTML != elem.value) {
                    elem.innerHTML = elem.value;
                    alert(elem.value);
                }
            }
            window.setInterval(decrypt, 1000);
        &lt;/script&gt;
    &lt;/head&gt;

    &lt;body&gt;
&lt;textarea id=&quot;pgp_msg&quot; style=&quot;height: 600px; width: 600px&quot;&gt;
-----BEGIN PGP MESSAGE-----
&lt;snip&gt;
-----END PGP MESSAGE-----
&lt;/textarea&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>A similar approach should also work for stealing a plaintext written in a text
box before it&#39;s encrypted.</p>

<h1><a name="index3h1"></a>Other ressources</h1>

<ul>
<li><p><a href="http://www.mail-archive.com/tor-talk@lists.torproject.org/msg02105.html">[tor-talk] Tor Browser Bundle: PGP encryption
built-in?</a><br />
A thread on the [tor-talk] list adressing the issues of supporting GPG inside a browser.</p></li>
<li><p><a href="http://lair.fifthhorseman.net/~dkg/firegpg-audit/spoof/">Spoofing OpenPGP signatures against
FireGPG</a><br />
Another possible attack on FireGPG.</p></li>
</ul>


<h1><a name="index4h1"></a>Other possible issues</h1>

<p>If it is possible to use JavaScript to check signatures, an attacker could
potentially learn the user&#39;s whole key chain by replaying messages and their
signatures made by those key holders. This would give the attacker an awful lot
of identifying bits of the user.</p>






</div>







</div>

<div id="footer" class="pagefooter" role="contentinfo">

<div id="pageinfo">







<div id="backlinks">
Pages linking to this one:

<a href="../../news/version_0.10.html">news/version 0.10</a>


</div>






</div>
<div id="mirrorlist">Mirror: <a href="https://tails.boum.org/ikiwiki.cgi?do=goto&page=doc/encryption_and_privacy/FireGPG_susceptible_to_devastating_attacks">tails.boum.org</a></div>

<!-- from The Amnesic Incognito Live System -->
</div>

</div>

<script type="text/javascript">
  var linkelements = document.querySelectorAll('.use-mirror-pool');
  // Avoid a traceback if mirror-dispatcher.js is not available.
  if (typeof replaceUrlPrefixWithRandomMirror !== "undefined" && linkelements.length > 0) {
    replaceUrlPrefixWithRandomMirror(linkelements);
  }
</script>

</body>
</html>
