<!DOCTYPE html>

<html lang="en" dir="ltr" xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Tails - Claws Mail leaks plaintext of encrypted emails to IMAP server</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="icon" href="../favicon.ico" type="image/x-icon" />

<link rel="stylesheet" href="../style.css" type="text/css" />

<link rel="stylesheet" href="../local.css?reload-2021-06-25" type="text/css" />


<script src="../lib/js/mirror-dispatcher.js" type="text/javascript"></script>





<meta name="date" content="Thu, 07 May 2015 12:34:56 +0000" />



</head>


<body class="en">


<div class="banner" role="banner">
  <a class="tails" href="../index.html"><span>Tails</span></a>
  <div id="search-and-donate">
    
    
    
    <div class="donate">
      <a href="https://tails.boum.org/donate/?r=topbar" class="en"><span>Donate</span></a>
      <a href="https://tails.boum.org/donate/?r=topbar" class="de"><span>Spenden</span></a>
      <a href="https://tails.boum.org/donate/?r=topbar" class="es"><span>Donar</span></a>
      <a href="https://tails.boum.org/donate/?r=topbar" class="fa"><span>اهدا کردن</span></a>
      <a href="https://tails.boum.org/donate/?r=topbar" class="fr"><span>Faire un don</span></a>
      <a href="https://tails.boum.org/donate/?r=topbar" class="it"><span>Dona</span></a>
      <a href="https://tails.boum.org/donate/?r=topbar" class="pt"><span>Faça uma doação</span></a>
      <a href="https://tails.boum.org/donate/?r=topbar" class="ru"><span>Пожертвовать</span></a>
    </div>
  </div>
</div>



<div class="topbar" role="navigation">
<ul>
  <li><a href="../index.html">Home</a></li>
  <li><a href="../about.en.html">How Tails works</a></li>
  <li><a href="../install.en.html">Get Tails</a></li>
  <li><a href="../doc.en.html">Documentation</a></li>
  <li><a href="../support.en.html">Support</a></li>
  <li><a href="../contribute.en.html">Contribute</a></li>
  <li><a href="../news.en.html">News</a></li>
  <li><a href="../jobs.html">Jobs</a></li>
</ul>


</div>



<div class="page">

<div class="pageheader">

<div class="parentlinks">
<ul id="crumbs">
<li><a href="../index.html"><img alt="home" src="../lib/home.png"></a></li>







<li><a href="../security.en.html">security</a></li>




<li>Claws Mail leaks plaintext of encrypted emails to IMAP server</li>

</ul>
</div>


<div id="otherlanguages">
<ul>
   
   <li class="current master">
   <span >English
   </span>
   </li>

   


   

   <li >

   <span class="visible"><a href="./claws_mail_leaks_plaintext_to_imap.de.html">de</a></span>
   <span class="hidden"><a href="./claws_mail_leaks_plaintext_to_imap.de.html">Deutsch</a></span>

   </li>
   

   <li >

   <span class="visible"><a href="./claws_mail_leaks_plaintext_to_imap.es.html">es</a></span>
   <span class="hidden"><a href="./claws_mail_leaks_plaintext_to_imap.es.html">Español</a></span>

   </li>
   

   <li >

   <span class="visible"><a href="./claws_mail_leaks_plaintext_to_imap.fr.html">fr</a></span>
   <span class="hidden"><a href="./claws_mail_leaks_plaintext_to_imap.fr.html">Français</a></span>

   </li>
   

   <li >

   <span class="visible"><a href="./claws_mail_leaks_plaintext_to_imap.it.html">it</a></span>
   <span class="hidden"><a href="./claws_mail_leaks_plaintext_to_imap.it.html">Italiano</a></span>

   </li>
   

   <li >

   <span class="visible"><a href="./claws_mail_leaks_plaintext_to_imap.pt.html">pt</a></span>
   <span class="hidden"><a href="./claws_mail_leaks_plaintext_to_imap.pt.html">Português</a></span>

   </li>
   

   <li >

   <span class="visible"><a href="./claws_mail_leaks_plaintext_to_imap.ru.html">ru</a></span>
   <span class="hidden"><a href="./claws_mail_leaks_plaintext_to_imap.ru.html">Русский</a></span>

   </li>
   
</ul>
</div>


<div class="header">
<span class="title">
Claws Mail leaks plaintext of encrypted emails to IMAP server
</span>
<span class="date">2015-05-07</span>
</div>






</div>

<div id="pagebody">

<div id="content" role="main">
<p>We discovered that <em>Claws Mail</em>, the email client in Tails, stores
plaintext copies of all emails on the remote IMAP server, including
those that are meant to be encrypted.</p>

<ul>
<li>When sending an email, <em>Claws Mail</em> copies the email in plaintext to
the sending queue of the IMAP server before encrypting the email.
<em>Claws Mail</em> deletes this plaintext copy after sending the email.</li>
<li><em>Claws Mail</em> drafts in plaintext on the server. An email can be
saved as draft either:

<ul>
<li>Manually by clicking on the <strong>Draft</strong> button when composing an email.</li>
<li>Automatically if you selected the <strong>automatically save message to
Draft folder</strong> option in the writing preferences. This option is
deselected by default in Tails.</li>
</ul>
</li>
</ul>


<p><strong>All users of <em>Claws Mail</em> using IMAP and its OpenPGP plug-in are affected.</strong></p>

<p>Users of <em>Claws Mail</em> using POP are not affected.</p>

<div class="tip">

To know if you are using IMAP or POP, choose <span class="menuchoice">
<span class="guimenu">Configuration</span>&nbsp;&#x25B8;
<span class="guimenuitem">Edit accounts&hellip;</span></span> and refer
to the <span class="guilabel">Protocol</span> column in the list of
accounts.

</div>


<p>Unfortunately, we were not yet able to fix the problem automatically and
for everybody. This would require to either modify <em>Claws Mail</em> or to
migrate to a different application. Refer to the workarounds section to
solve this problem in your setup and please warn others around you.</p>

<div class="toc">
<ol>
	<li class="L1"><a href="#index1h1">Workarounds</a>
	<ol>
		<li class="L2"><a href="#index1h2">Verify the content of your Drafts folder</a>
		</li>
		<li class="L2"><a href="#index2h2">Use POP instead of IMAP</a>
		</li>
		<li class="L2"><a href="#index3h2">Use local Drafts and Queue folders</a>
		</li>
	</ol>
	</li>
	<li class="L1"><a href="#index2h1">Long term solution</a>
	</li>
	<li class="L1"><a href="#index3h1">Technical details</a>
	<ol>
		<li class="L2"><a href="#index4h2">Leak through the sending queue</a>
		</li>
	</ol>
	</li>
</ol>
</div>


<h1><a name="index1h1"></a>Workarounds</h1>

<h2><a name="index1h2"></a>Verify the content of your <strong>Drafts</strong> folder</h2>

<p>First of all, verify the content of the <strong>Drafts</strong> folder on the server,
either through <em>Claws Mail</em> or through the web
interface of your email provider. Delete any plaintext email that might
have been stored against your will in this folder until now.</p>

<p>Then apply one of the other two workarounds to prevent more leaks in the future.</p>

<h2><a name="index2h2"></a>Use POP instead of IMAP</h2>

<p><em>Claws Mail</em> can connect to the email server using either the IMAP or POP
protocol.</p>

<ul>
<li>With IMAP, <em>Claws Mail</em> constantly synchronizes with the server and
displays the emails and folders that are currently stored on the
server. IMAP is better suited if you access your emails from
different operating systems.</li>
<li>With POP, <em>Claws Mail</em> downloads the emails that are in the inbox
on the server and possibly removes them from the server. POP is
better suited if you access emails from Tails only and store them in
the persistent volume.</li>
</ul>


<p>To know more, see also this Yahoo! Help page on <a href="https://help.yahoo.com/kb/mail-for-desktop/compare-differences-pop-imap-sln3769.html">comparing the
differences between POP and
IMAP</a>.</p>

<p>POP is not affected at all by this security problem. When using POP,
only encrypted emails are sent to the server. So consider switching to
POP if you have an email account dedicated to your activities on Tails.
To do so:</p>

<ol>
<li><p>Choose <strong>File</strong>&nbsp;&#x25B8; <strong>Add mailbox</strong>&nbsp;&#x25B8; <strong>MH&hellip;</strong> to
create a local mailbox where to download your emails.</p></li>
<li><p>To store the mailbox in the persistent volume, specify
<span class="command">.claws-mail/Mail</span> as location.
Make sure to type the <span class="command">.</span> before
<span class="command">claws-mail/Mail</span>.</p>

<p> <img class="img" height="246" src="./claws_mail_leaks_plaintext_to_imap/add_mailbox.png" width="355" /></p></li>
<li><p>Choose <strong>Configuration</strong>&nbsp;&#x25B8; <strong>Edit accounts&hellip;</strong>, select
your IMAP account in the list of accounts, and click <strong>Delete</strong> to
delete it. Doing so does not delete any email stored on the server.</p></li>
<li><p>Click <strong>New</strong> and configure this new account as specified by your
email provider.</p>

<ul>
<li>In the <strong>Basic</strong> tab, make sure that the <strong>Protocol</strong> option is set
to <strong>POP3</strong>.</li>
<li><p>In the <strong>Receive</strong> tab, click on the <strong>Browse</strong> button of the
<strong>Default Inbox</strong> option and select the <strong>Inbox</strong> folder of the
mailbox that you created in step 2.</p>

<p><img class="img" height="318" src="./claws_mail_leaks_plaintext_to_imap/select_inbox.png" width="302" /></p></li>
<li><p>If you want to keep a copy of the received emails on the server,
verify the preferences in the <strong>Receive</strong> tab. We recommend you to
disable the <strong>Remove messages on server when received</strong> option
until you make sure that the emails are stored in the persistent
volume.</p></li>
</ul>
</li>
<li><p>Close the preferences dialog and the list of accounts to go back to
the main window of <em>Claws Mail</em>.</p></li>
<li><p>Click on the <strong>Get Mail</strong> button to download all emails from the
inbox on the server. Emails in other folders are not downloaded.</p></li>
</ol>


<h2><a name="index3h2"></a>Use local <strong>Drafts</strong> and <strong>Queue</strong> folders</h2>

<p>If you want to continue using IMAP, you should configure your IMAP
account to use <strong>Drafts</strong> and <strong>Queue</strong> folders stored in Tails instead
of on the server. To do so:</p>

<ol>
<li><p>Choose <strong>Add mailbox</strong>&nbsp;&#x25B8; <strong>MH&hellip;</strong> to create a local
mailbox where to save your drafts and queued emails.</p></li>
<li><p>To store the mailbox in the persistent volume, specify
<span class="command">.claws-mail/Mail</span> as location.
Make sure to type the <span class="command">.</span> before
<span class="command">claws-mail/Mail</span>.</p>

<p> <img class="img" height="246" src="./claws_mail_leaks_plaintext_to_imap/add_mailbox.png" width="355" /></p></li>
<li><p>Choose <strong>Configuration</strong>&nbsp;&#x25B8; <strong>Edit accounts&hellip;</strong>, select
your IMAP account in the list of accounts, and click <strong>Edit</strong> to edit
its preferences.</p></li>
<li><p>Select <strong>Advanced</strong> in the left pane.</p></li>
<li><p>Select the <strong>Put queued messages in</strong> option, click <strong>Browse</strong>, and
select the <strong>Queue</strong> folder of the <strong>MH</strong> mailbox.</p></li>
<li><p>Select the <strong>Put draft messages in</strong> option, click <strong>Browse</strong>, and
select the <strong>Drafts</strong> folder of the <strong>MH</strong> mailbox.</p></li>
</ol>


<p><img class="img" height="221" src="./claws_mail_leaks_plaintext_to_imap/local_folders.png" width="551" /></p>

<h1><a name="index2h1"></a>Long term solution</h1>

<p>As for the possible long term solutions to this problem, we are
considering:</p>

<ul>
<li><p>Getting the development team of <em>Claws Mail</em> to <a href="http://www.thewildbeast.co.uk/claws-mail/bugzilla/show_bug.cgi?id=2965">fix the problem upstream</a>.
We contacted them about this
problem already. Please help them provide a technical
solution if you can.</p></li>
<li><p>Replacing <em>Claws Mail</em> with <em>Icedove</em> (the name of <em>Mozilla Thunderbird</em> in
Debian). We have been willing to do so for years and this problem
motivates us to move faster.</p></li>
</ul>


<h1><a name="index3h1"></a>Technical details</h1>

<h2><a name="index4h2"></a>Leak through the sending queue</h2>

<p>When sending an email from an IMAP account, <em>Claws Mail</em> does the following:</p>

<ol>
<li><p>It connects to the IMAP server and stores a plaintext copy of the
email in the <strong>Queue</strong> folder on the server.</p></li>
<li><p>It encrypts the email locally.</p></li>
<li><p>It sends the encrypted email through the SMTP server.</p></li>
<li><p>It connects to the IMAP server and stores an encrypted copy of the
email in the <strong>Sent</strong> folder on the server.</p></li>
<li><p>It connects to the IMAP server and deletes the plaintext email
saved in step 1 from the <strong>Queue</strong> folder.</p></li>
</ol>


</div>







</div>

<div id="footer" class="pagefooter" role="contentinfo">

<div id="pageinfo">





<div class="tags">
Tags:

<a href="../tags/security/fixed.html" rel="tag">security/fixed</a>

</div>



<div id="backlinks">
Pages linking to this one:

<a href="../news/version_1.4.html">news/version 1.4</a>


</div>






</div>
<div id="mirrorlist">Mirror: <a href="https://tails.boum.org/ikiwiki.cgi?do=goto&page=security/claws_mail_leaks_plaintext_to_imap">tails.boum.org</a></div>

<!-- from The Amnesic Incognito Live System -->
</div>

</div>

<script type="text/javascript">
  var linkelements = document.querySelectorAll('.use-mirror-pool');
  // Avoid a traceback if mirror-dispatcher.js is not available.
  if (typeof replaceUrlPrefixWithRandomMirror !== "undefined" && linkelements.length > 0) {
    replaceUrlPrefixWithRandomMirror(linkelements);
  }
</script>

</body>
</html>
